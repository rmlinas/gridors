---
import Navigation from '../components/Navigation.astro';
import Sidebar from '../components/Sidebar.astro';
import Footer from '../components/Footer.astro';
import Logo from '../components/Logo.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  image?: string;
  showSidebar?: boolean;
  fullWidth?: boolean;
  contentGridClass?: string;
}

const {
  title: propTitle,
  description: propDescription,
  image: propImage,
  showSidebar: receivedShowSidebar = true,
  fullWidth = false,
  contentGridClass: receivedContentGridClass = receivedShowSidebar ? 'lg:col-span-8' : 'lg:col-span-12'
} = Astro.props;

let finalShowSidebar = receivedShowSidebar;
let finalContentGridClass = receivedContentGridClass;

if (Astro.url.pathname === '/resources/tools/power-calculator/') {
  finalShowSidebar = false;
  finalContentGridClass = 'lg:col-span-12';
}

const title = propTitle || 'Gridors';
const description = propDescription || 'Gridors: Empowering Self-Reliance and Resilience for a Modern World.';
const image = propImage || '/social-preview.png';
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

  <title>{title} | Gridors</title>
  <meta name="description" content={description} />
  <link rel="canonical" href={canonicalURL} />
  <meta property="og:title" content={`${title} | Gridors`} />
  <meta property="og:description" content={description} />
  <meta property="og:url" content={canonicalURL} />
  <meta property="og:image" content={new URL(image, Astro.site)} />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Gridors" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={`${title} | Gridors`} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={new URL(image, Astro.site)} />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&family=Inter:wght@300;400;500;600;700&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<script>
  var _paq = window._paq = window._paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//gridors.com/analytics/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>


</head>

<body class="min-h-screen flex flex-col font-inter text-gray-800 antialiased leading-relaxed tracking-wide bg-gradient-to-br from-gridors-light to-white bg-fixed" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAwIiBoZWlnaHQ9IjUwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnL2IwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNTAwIiBoZWlnaHQ9IjUwMCIgZmlsbD0iI2ZmZiIvPjxwYXRoIGQ9Ik0wIDI1TDI1IDBMNTAgMjVMNzUgMFoxMDAgMjVMMTI1IDBMMTUwIDI1TDE3NSAwTDIwMCAyNUwyMjUgMEwyNTAgMjVMMjc1IDBMMzAwIDI1TDMyNSAwTDM1MCAyNUwzNzUgMEw0MDAgMjVMNDI1IDBMNDUwIDI1TDQ3NSAwTDUwMCAyNVY1MEgweiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2JhKDIwMCwyMDAsMjAwLDAuMDUpIiBzdHJva2Utd2lkdGg9IjEiLz48L3N2Z24=');">
  


<header class="bg-black/90 backdrop-blur-sm shadow-lg sticky top-0 z-50 border-b border-gray-800">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
    <a href="/" class="flex items-center space-x-2 group">
      <Logo />
    </a>
    <Navigation />
  </div>
</header>

<main class="flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
    
    <div class:list={[
      "col-span-full w-full",
      finalContentGridClass
    ]}>
      <slot />
    </div>

    {finalShowSidebar && (
      <aside class="lg:col-span-4 col-span-full"> 
        <Sidebar />
      </aside>
    )}
  </div>
</main>

<Footer />
</body>
</html>

<style is:global>
:root {
  --color-primary: #166534;
  --color-primary-light: #4CAF50;
  --color-accent: #E1B62C;
  --color-muted: #6B7280;
  --color-light: #F9FAFB;
  --color-gridors-primary-darker: #1F2937;

  --font-heading: 'Oswald', sans-serif;
  --font-body: 'Inter', sans-serif;
  --font-mono: 'IBM Plex Mono', monospace;
}

body {
  font-family: var(--font-body);
}

.nav-link {
  color: #e5e7eb;
  text-decoration: none;
  font-weight: 600;
  font-size: 1rem;
  padding: 0.5rem 0.5rem;
  position: relative;
  transition: color 0.3s ease, background-color 0.3s ease;
  display: inline-block;
  flex-shrink: 0;
  border-radius: 0.375rem;
}
.nav-link::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  height: 2px;
  width: 0;
  background-color: var(--color-primary-light);
  transition: width 0.3s ease;
  border-radius: 1px;
}
.nav-link:hover {
  color: var(--color-primary-light);
  background-color: rgba(255, 255, 255, 0.1);
}
.nav-link:hover::after {
  width: calc(100% - 1rem);
}
.nav-link.active {
  color: var(--color-primary-light);
  background-color: rgba(255, 255, 255, 0.15);
  box-shadow: inset 0 0 0 1px var(--color-primary);
}

.mobile-nav-link {
  width: 100%;
  text-align: center;
  padding: 0.75rem 1rem;
  font-size: 1.25rem;
  transition: color 0.2s ease, background-color 0.2s ease;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.5rem;
  color: white;
  border-radius: 0.375rem;
  user-select: none;
  cursor: pointer;
}
.mobile-nav-link:hover,
.mobile-nav-link:focus {
  color: var(--color-primary-light);
  background-color: var(--color-gridors-primary-darker);
  outline: none;
}
.mobile-nav-link.active {
  color: var(--color-primary-light);
  background-color: var(--color-gridors-primary-darker);
}

@media (min-width: 769px) {
  .desktop-dropdown-menu {
    background-color: #fff !important;
    color: #1f2937 !important;
    border-radius: 0.5rem;
    box-shadow:
      0 4px 6px rgba(0, 0, 0, 0.1),
      0 1px 3px rgba(0, 0, 0, 0.08);
    padding: 0.5rem 0;
    min-width: 180px;
    z-index: 1000;
    opacity: 1 !important;
    background-image: none !important;
  }
  .desktop-dropdown-menu a {
    color: #1f2937 !important;
    padding: 0.5rem 1rem;
    display: block;
    text-decoration: none;
    border-radius: 0.375rem;
    transition: background-color 0.2s, color 0.2s;
  }
  .desktop-dropdown-menu a:hover,
  .desktop-dropdown-menu a:focus {
    background-color: var(--color-primary-light);
    color: #fff;
    outline: none;
  }
}

@media (max-width: 1023px) {
  .mobile-dropdown-menu {
    background-color: #000;
    color: #fff;
    opacity: 1;
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1), 0 1px 3px rgba(0,0,0,0.08);
    padding: 0.5rem 0;
    z-index: 1000;
  }
  .mobile-dropdown-menu a {
    background-color: #000;
    color: white;
  }
  .mobile-dropdown-menu a:hover,
  .mobile-dropdown-menu a:focus {
    background-color: var(--color-gridors-primary-darker);
    color: var(--color-primary-light);
    outline: none;
  }
}

.base-card-block {
  background-color: white;
  border: 1px solid var(--color-light);
  border-radius: 1.5rem;
  box-shadow:
    0 4px 6px rgba(0, 0, 0, 0.01),
    0 1px 3px rgba(0, 0, 0, 0.05);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.base-card-block:hover {
    transform: translateY(-2px);
    box-shadow: 
        0 10px 15px -3px rgba(0, 0, 0, 0.1),
        0 4px 6px -2px rgba(0, 0, 0, 0.05);
}


.content-panel {
  padding: 2.5rem;
}


.section-title {
  font-size: 1.75rem;
  font-weight: 700;
  margin-bottom: 1.5rem;
  color: var(--color-primary);
  position: relative;
  display: inline-block;
  font-family: var(--font-heading);
}

a {
  color: var(--color-primary);
  text-decoration: none;
  font-weight: 500;
  position: relative;
  transition: color 0.2s ease;
}
a::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 0;
  height: 2px;
  background: var(--color-accent);
  transition: width 0.3s ease;
}
a:hover,
a:focus {
  color: var(--color-accent);
  outline: none;
}
a:hover::after,
a:focus::after {
  width: 100%;
}

.btn {
  display: inline-block;
  padding: 0.85rem 2rem;
  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
  color: white;
  border-radius: 0.75rem;
  font-weight: 600;
  text-align: center;
  transition: all 0.3s ease;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  border: none;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  user-select: none;
}
.btn:hover,
.btn:focus {
  transform: translateY(-2px);
  box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
  outline: none;
}
.btn:active {
  transform: translateY(0);
}
.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.7s ease;
  pointer-events: none;
}
.btn:hover::before,
.btn:focus::before {
  left: 100%;
}
.btn-secondary{
  background:none;
  background-color:#e5e7eb;
  color:#1f2937;
  border:1px solid #d1d5db
}
.btn-secondary:hover,
.btn-secondary:focus {
  background-color:#d1d5db;
  transform:translateY(-2px);
  box-shadow:0 4px 10px #0000000d;
  outline: none;
}

.article-content {
  font-size: 1.125rem;
  line-height: 1.75;
  color: #374151;
}
.article-content p {
  margin-bottom: 1.5em;
}
.article-content h1,
.article-content h2,
.article-content h3,
.article-content h4,
.article-content h5,
.article-content h6 {
  font-family: var(--font-heading);
  font-weight: 700;
  margin-top: 2em;
  margin-bottom: 0.8em;
  color: #1f2937;
  line-height: 1.2;
}
.article-content h1 { font-size: 2.5rem; }
.article-content h2 { font-size: 2.25rem; }
.article-content h3 { font-size: 1.875rem; }
.article-content h4 { font-size: 1.5rem; }
.article-content ul,
.article-content ol {
  margin-left: 1.5em;
  margin-bottom: 1.5em;
  padding-left: 0.5em;
}
.article-content ul li {
  list-style-type: disc;
  margin-bottom: 0.5em;
}
.article-content ol li {
  list-style-type: decimal;
  margin-bottom: 0.5em;
}
.article-content a {
  color: var(--color-primary);
  text-decoration: underline;
  font-weight: 500;
}
.article-content a:hover,
a:focus {
  color: var(--color-accent);
  outline: none;
}
.article-content a:hover::after,
a:focus::after {
  width: 100%;
}
.article-content strong {
  font-weight: 700;
  color: #1f2937;
}
.article-content pre {
  border-radius: 0.75rem;
  padding: 1.5rem;
  margin: 2rem 0;
  background: #1e293b;
  color: #f8fafc;
  overflow-x: auto;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  font-family: var(--font-mono);
  font-size: 0.9rem;
  line-height: 1.4;
}
.article-content code {
  font-family: var(--font-mono);
  background-color: rgba(229, 231, 235, 0.3);
  padding: 0.15em 0.3em;
  border-radius: 0.25rem;
}
.article-content blockquote {
  border-left: 4px solid var(--color-primary-light);
  padding-left: 1.5em;
  margin: 2em 0;
  font-style: italic;
  color: #4b5563;
  background-color: rgba(243, 244, 246, 0.8);
  border-radius: 0.375rem;
}

/* Scrollbar styles */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}
::-webkit-scrollbar-track {
  background: transparent;
}
::-webkit-scrollbar-thumb {
  background-color: rgba(100, 116, 139, 0.5);
  border-radius: 4px;
  border: 2px solid transparent;
  background-clip: content-box;
}

/* Accessibility focus outline */
:focus-visible {
  outline: 2px solid var(--color-primary-light);
  outline-offset: 2px;
}
</style>